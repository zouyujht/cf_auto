# 工作流的名称
name: Sync Single File from Upstream

# 工作流的触发条件
on:
  # 使用 schedule 来设置定时任务
  schedule:
    # cron 表达式，'0 16 * * *' 代表 UTC 时间的每天 16:00
    # 由于 GitHub Actions 使用 UTC 时间，UTC 16:00 相当于 GMT+8 (北京时间) 的 00:00
    - cron: '0 16 * * *'
  
  # 添加 workflow_dispatch 允许您在 Actions 页面手动点击按钮来触发此工作流
  # 方便您进行测试
  workflow_dispatch:

# 定义工作流中的任务 (jobs)
jobs:
  sync:
    # 指定任务运行的虚拟环境
    runs-on: ubuntu-latest

    # ======================================================= #
    # VVVVVV           【这里是需要添加的内容】           VVVVVV #
    # ------------------------------------------------------- #
    # 为此任务授予权限，允许它向仓库中写入内容
    permissions:
      contents: write
    # ------------------------------------------------------- #
    # ^^^^^^           【这里是需要添加的内容】           ^^^^^^ #
    # ======================================================= #

    # 定义任务中的步骤 (steps)
    steps:
      # 第一步：检出 (checkout) 您自己的仓库代码
      - name: Checkout repository
        uses: actions/checkout@v4

      # 第二步：下载指定 URL 的文件并重命名
      - name: Download and Rename File
        run: curl -o _work.js -L "https://github.com/byJoey/cfnew/raw/main/%E5%B0%91%E5%B9%B4%E4%BD%A0%E7%9B%B8%E4%BF%A1%E5%85%89%E5%90%97"

      # 第三步：配置 Git 用户信息
      - name: Configure Git
        run: |
          git config --global user.name 'github-actions[bot]'
          git config --global user.email 'github-actions[bot]@users.noreply.github.com'

      # 第四步：提交并推送文件到您的仓库
      - name: Commit and Push if changed
        run: |
          git add _work.js
          git diff --staged --quiet || (git commit -m "chore: Auto sync _work.js from upstream" && git push)
          echo "Sync completed."
